<?xml version="1.0" encoding="UTF-8"?><html xmlns:c="http://www.concordion.org/2007/concordion" lang="en">
<head><script type="text/javascript">/* Stack Trace Toggling */

function getElementById(id) {
  var element;

  if (document.getElementById) { // standard
    return document.getElementById(id);
  } else if (document.all) { // old IE versions
    return document.all[id];
  } else if (document.layers) { // nn4
    return document.layers[id];
  }
  alert("Sorry, but your web browser is not supported by Concordion.");
}

function isVisible(element) {
  return element.style.display;
}

function makeVisible(element) {
  element.style.display = "block";
}

function makeInvisible(element) {
  element.style.display = "";
}

function toggleStackTrace(stackTraceNumber) {
  var stackTrace = getElementById("stackTrace" + stackTraceNumber);
  var stackTraceButton = getElementById("stackTraceButton" + stackTraceNumber);
  if (isVisible(stackTrace)) {
    makeInvisible(stackTrace);
    stackTraceButton.value = "View Stack";
  } else {
    makeVisible(stackTrace);
    stackTraceButton.value = "Hide Stack";
  }
}
</script><style>* {
  font-family: Arial;
}
body {
  padding: 32px;  
}
pre {
  padding: 6px 28px 6px 28px;
  background-color: #E8EEF7;
}
pre, pre *, code, code *, kbd {
  font-family: Courier New, Courier;
  font-size: 10pt;
}
h1, h1 * {
  font-size: 24pt;	
}
p, td, th, li, .breadcrumbs {
  font-size: 10pt;
}
p, li {
  line-height: 140%;
  max-width: 720px;
}
table {
  border-collapse: collapse;
  empty-cells: show;
  margin: 8px 0px 8px 0px;
}
th, td {
  border: 1px solid black;
  padding: 3px;
}
td {
  background-color: white;
  vertical-align: top;
}
th {
  background-color: #C3D9FF;
}
li {
  margin-top: 6px;
  margin-bottom: 6px; 
}

.example {
  padding: 6px 16px 6px 16px;
  border: 1px solid #C3D9FF;
  margin: 6px 0px 28px 0px;
  background-color: #F5F9FD;
}
.example h3 {
  margin-top: 8px;
  margin-bottom: 8px;
  font-size: 12pt;
}

p.success {
  padding: 2px;
}
.success, .success * {
  background-color: #afa !important;
}
.success pre {
  background-color: #bbffbb;
}
.failure, .failure * {
  background-color: #ffb0b0;
  padding: 1px;
}
.failure .expected {
  text-decoration: line-through;
  color: #bb5050;
}
.ignored, .ignored * {
  background-color: #f0f0f0 !important;	
}

ins {
  text-decoration: none;	
}

.exceptionMessage {
  background-color: #fdd;
  font-family: Courier New, Courier, Monospace;
  font-size: 10pt;
  display: block;
  font-weight: normal;
  padding: 4px;
  text-decoration: none !important;
}
.stackTrace, .stackTrace * {
  font-weight: normal;
}
.stackTrace {
  display: none;
  padding: 1px 4px 4px 4px;
  background-color: #fdd;
  border-top: 1px dotted black;
}
.stackTraceExceptionMessage {
  display: block;
  font-family: Courier New, Courier, Monospace;
  font-size: 8pt;
  white-space: wrap;
  padding: 1px 0px 1px 0px;
}
.stackTraceEntry {
  white-space: nowrap;
  font-family: Courier New, Courier, Monospace;
  display: block;
  font-size: 8pt;
  padding: 1px 0px 1px 32px;
}
.stackTraceButton {
  font-size: 8pt;
  margin: 2px 8px 2px 0px;
  font-weight: normal;
  font-family: Arial;
}

.special {
  font-style: italic;
}
.missing, .missing * {
  background-color: #ff9999;
  color:#bb5050;
  text-decoration: line-through;
}
.surplus, .surplus * {
  background-color: #ff9999;
}
.footer {
  text-align: right;
  margin-top: 40px;
  font-size: 8pt;
  width: 100%;
  color: #999;
}
.footer .testTime {
  padding: 2px 10px 0px 0px;
}

.idea {
  font-size: 9pt;
  color: #888;
  font-style: italic;	
}
.tight li {
  margin-top: 1px;
  margin-bottom: 1px; 
}
.commentary {
  float: right;
  width: 200px;
  background-color: #ffffd0;
  padding:8px;
  border: 3px solid #eeeeb0;	 
  margin: 10px 0px 10px 10px;	 
}
.commentary, .commentary * {
  font-size: 8pt;
}
</style><meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta charset="UTF-8" />
    <link href="../../../concordion.css" rel="stylesheet" type="text/css" />
    <title>Preauthorization via Klarna Invoice</title>
<link type="text/css" rel="stylesheet" href="../../../inputstyle.css" /></head>
<body><span class="breadcrumbs"><a href="../../Specs.html">commercetools - PAYONE - Integration Service</a> &gt; <a href="../Paymentmethods.html">Payment Methods</a> &gt; <a href="Klarna.html">Payments via Klarna Invoice (KLV)</a> &gt;</span>
<h1>Preauthorization via Klarna Invoice</h1>
<p>
    It will store information about such a request as an interface interaction of type
    <em>PAYONE_INTERACTION_REQUEST</em>.
</p>
<h2>Examples</h2>
<h3>Common Setup</h3>
<ul>
    <li>payment.paymentMethodInfo.method: <span>INVOICE-KLARNA</span></li>
</ul>
<p>
    Since Klarna has
    <a href="https://developers.klarna.com/en/de/kpm/test-credentials">
        very strict requirements to the payment request</a>,
    the main cart payment properties are mocked in respective JSON files
    (see <code>mocks/paymentmethods/klarna/KlarnaCartWithDiscounts.json</code>)
    <br />
    Below we customize the following payment properties for a Klarna Invoice.
</p>
<div class="example">
    <h3>Create the payments</h3>
    <table c:execute="#result = createPayment(#paymentName, #transactionType, #ip, #buyerLastName, #birthDay, #telephonenumber)">
        <tr>
            <th c:set="#paymentName">Payment Name</th>
            <th c:set="#transactionType">Transaction Type</th>
            <th c:set="#buyerLastName">Buyer surname<sup><a href="#buyer-lastname-description">[1]</a></sup></th>
            <th c:set="#birthDay">Buyer birth day</th>
            <th c:set="#ip">IP address</th>
            <th c:set="#telephonenumber">Telephone</th>
            <th c:echo="#result.paymentId">Payment ID (for information only)</th>
            <th c:assertEquals="#result.birthday">Birthday</th>
            <th c:assertEquals="#result.ip">IP</th>
            <th c:assertEquals="#result.telephonenumber">Telephone</th>
        </tr>
        <tr><span class="failure"><del class="expected">
            <td class="inputvalue">Payment 1</td>
            <td class="inputvalue">AUTHORIZATION</td>
            <td class="inputvalue">Approved</td> <!-- It's a buyer surname, see https://developers.klarna.com/en/de/kpm/test-credentials-->
            <td class="inputvalue">1960-07-07</td>
            <td class="inputvalue">192.168.0.45</td>
            <td class="inputvalue">034568557</td>
            <td />
            <td>1960-07-07</td>
            <td>192.168.0.45</td>
            <td>034568557</td>
        </del></span><span class="exceptionMessage">java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/328a3c78-6610-412a-82c2-cd8248e6de74 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5` on 2018-02-06T11:13:06.746Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "7a73e539-5eeb-4cda-b8fa-c338347bde1e"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@7fa85bf9[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5], Server-Timing=[projects=9; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:06 GMT], Via=[1.1 google], X-Served-By=[api-gce-ebb1810c.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"7a73e539-5eeb-4cda-b8fa-c338347bde1e"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/328a3c78-6610-412a-82c2-cd8248e6de74
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:04.085Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=328a3c78-6610-412a-82c2-cd8248e6de74,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:05.132Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=bf308b69-60d6-4c99-aeba-ace62381ccae,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=a7ae26c5-a151-40ea-a482-4e06785476ae,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=59c3df31-352e-4561-8e42-3fc2a816af45,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='7a73e539-5eeb-4cda-b8fa-c338347bde1e', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:05.997Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="270125635704", birthday="1960-07-07", ip="192.168.0.45", languageCode="en", telephonenumber="034568557", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=7a73e539-5eeb-4cda-b8fa-c338347bde1e,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:05.997Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=ebad81dc-2ae1-4f30-9b6a-d80d79a86954,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:05.502Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/328a3c78-6610-412a-82c2-cd8248e6de74,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5]},body=io.sphere.sdk.http.StringHttpRequestBody@3e5f2ad6[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"7a73e539-5eeb-4cda-b8fa-c338347bde1e"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "7a73e539-5eeb-4cda-b8fa-c338347bde1e"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</span><input class="stackTraceButton" id="stackTraceButton1" type="button" onclick="javascript:toggleStackTrace('1')" value="View Stack" /><div class="stackTrace" id="stackTrace1"><p>While evaluating expression: <code>#result = createPayment(#paymentName, #transactionType, #ip, #buyerLastName, #birthDay, #telephonenumber)</code></p><div class="stackTraceExceptionMessage">org.concordion.internal.InvalidExpressionException: java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/328a3c78-6610-412a-82c2-cd8248e6de74 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5` on 2018-02-06T11:13:06.746Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "7a73e539-5eeb-4cda-b8fa-c338347bde1e"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@7fa85bf9[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5], Server-Timing=[projects=9; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:06 GMT], Via=[1.1 google], X-Served-By=[api-gce-ebb1810c.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"7a73e539-5eeb-4cda-b8fa-c338347bde1e"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/328a3c78-6610-412a-82c2-cd8248e6de74
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:04.085Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=328a3c78-6610-412a-82c2-cd8248e6de74,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:05.132Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=bf308b69-60d6-4c99-aeba-ace62381ccae,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=a7ae26c5-a151-40ea-a482-4e06785476ae,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=59c3df31-352e-4561-8e42-3fc2a816af45,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='7a73e539-5eeb-4cda-b8fa-c338347bde1e', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:05.997Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="270125635704", birthday="1960-07-07", ip="192.168.0.45", languageCode="en", telephonenumber="034568557", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=7a73e539-5eeb-4cda-b8fa-c338347bde1e,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:05.997Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=ebad81dc-2ae1-4f30-9b6a-d80d79a86954,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:05.502Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/328a3c78-6610-412a-82c2-cd8248e6de74,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5]},body=io.sphere.sdk.http.StringHttpRequestBody@3e5f2ad6[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"7a73e539-5eeb-4cda-b8fa-c338347bde1e"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "7a73e539-5eeb-4cda-b8fa-c338347bde1e"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.encodeThrowable (CompletableFuture.java:273)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.completeThrowable (CompletableFuture.java:280)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:604)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div><div class="stackTraceExceptionMessage">java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/328a3c78-6610-412a-82c2-cd8248e6de74 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5` on 2018-02-06T11:13:06.746Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "7a73e539-5eeb-4cda-b8fa-c338347bde1e"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@7fa85bf9[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5], Server-Timing=[projects=9; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:06 GMT], Via=[1.1 google], X-Served-By=[api-gce-ebb1810c.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"7a73e539-5eeb-4cda-b8fa-c338347bde1e"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/328a3c78-6610-412a-82c2-cd8248e6de74
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:04.085Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=328a3c78-6610-412a-82c2-cd8248e6de74,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:05.132Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=bf308b69-60d6-4c99-aeba-ace62381ccae,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=a7ae26c5-a151-40ea-a482-4e06785476ae,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=59c3df31-352e-4561-8e42-3fc2a816af45,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='7a73e539-5eeb-4cda-b8fa-c338347bde1e', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:05.997Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="270125635704", birthday="1960-07-07", ip="192.168.0.45", languageCode="en", telephonenumber="034568557", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=7a73e539-5eeb-4cda-b8fa-c338347bde1e,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:05.997Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=ebad81dc-2ae1-4f30-9b6a-d80d79a86954,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:05.502Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/328a3c78-6610-412a-82c2-cd8248e6de74,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5]},body=io.sphere.sdk.http.StringHttpRequestBody@3e5f2ad6[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"7a73e539-5eeb-4cda-b8fa-c338347bde1e"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "7a73e539-5eeb-4cda-b8fa-c338347bde1e"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.encodeThrowable (CompletableFuture.java:273)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.completeThrowable (CompletableFuture.java:280)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:604)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div><div class="stackTraceExceptionMessage">io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/328a3c78-6610-412a-82c2-cd8248e6de74 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5` on 2018-02-06T11:13:06.746Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "7a73e539-5eeb-4cda-b8fa-c338347bde1e"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@7fa85bf9[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5], Server-Timing=[projects=9; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:06 GMT], Via=[1.1 google], X-Served-By=[api-gce-ebb1810c.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"7a73e539-5eeb-4cda-b8fa-c338347bde1e"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/328a3c78-6610-412a-82c2-cd8248e6de74
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:04.085Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=328a3c78-6610-412a-82c2-cd8248e6de74,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:05.132Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=bf308b69-60d6-4c99-aeba-ace62381ccae,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=a7ae26c5-a151-40ea-a482-4e06785476ae,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=59c3df31-352e-4561-8e42-3fc2a816af45,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='7a73e539-5eeb-4cda-b8fa-c338347bde1e', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:05.997Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="270125635704", birthday="1960-07-07", ip="192.168.0.45", languageCode="en", telephonenumber="034568557", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=7a73e539-5eeb-4cda-b8fa-c338347bde1e,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:05.997Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=ebad81dc-2ae1-4f30-9b6a-d80d79a86954,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:05.502Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/328a3c78-6610-412a-82c2-cd8248e6de74,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/88f381df-35e0-40d7-9a65-0098be4d35a5]},body=io.sphere.sdk.http.StringHttpRequestBody@3e5f2ad6[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"7a73e539-5eeb-4cda-b8fa-c338347bde1e"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "7a73e539-5eeb-4cda-b8fa-c338347bde1e"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.lambda$of$13 (ExceptionFactory.java:57)</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.lambda$whenStatus$1 (ExceptionFactory.java:31)</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.createException (ExceptionFactory.java:76)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.createExceptionFor (SphereClientImpl.java:149)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.parse (SphereClientImpl.java:134)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.processHttpResponse (SphereClientImpl.java:128)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.lambda$executeWithRecover$4 (SphereClientImpl.java:85)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:602)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div></div></tr>
        <tr><span class="failure"><del class="expected">
            <td class="inputvalue">Payment 2</td>
            <td class="inputvalue">AUTHORIZATION</td>
            <td class="inputvalue">Approved</td> <!-- It's a buyer surname, see https://developers.klarna.com/en/de/kpm/test-credentials-->
            <td class="inputvalue">1960-07-07</td>
            <td class="inputvalue">2001:0db8:7777:0000:6666:8a2e:0370:7334</td>
            <td class="inputvalue">0399874789345</td>
            <td />
            <td>1960-07-07</td>
            <td>2001:0db8:7777:0000:6666:8a2e:0370:7334</td>
            <td>0399874789345</td>
        </del></span><span class="exceptionMessage">java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/aa10b90c-81af-463f-a9b9-ae245b48ba23 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526` on 2018-02-06T11:13:09.147Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "b4f1de47-6ea0-43e6-85ca-e7480c8be526"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@2800172c[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526], Server-Timing=[projects=7; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:09 GMT], Via=[1.1 google], X-Served-By=[api-gce-40bb8d66.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"b4f1de47-6ea0-43e6-85ca-e7480c8be526"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/aa10b90c-81af-463f-a9b9-ae245b48ba23
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:07.185Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=aa10b90c-81af-463f-a9b9-ae245b48ba23,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:07.839Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=e6652de3-0075-4689-b192-a7c1e5b5565d,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=13f62add-852a-459d-9ba6-34cd3d78cc58,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=0dc5c409-1a03-4833-93db-102f96c27a84,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='b4f1de47-6ea0-43e6-85ca-e7480c8be526', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:08.517Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="272331122470", birthday="1960-07-07", ip="2001:0db8:7777:0000:6666:8a2e:0370:7334", languageCode="en", telephonenumber="0399874789345", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=b4f1de47-6ea0-43e6-85ca-e7480c8be526,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:08.517Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=ebc8efd9-69de-4c23-b0dd-d1bc1a5ad846,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:08.264Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/aa10b90c-81af-463f-a9b9-ae245b48ba23,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526]},body=io.sphere.sdk.http.StringHttpRequestBody@1f7e9a66[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"b4f1de47-6ea0-43e6-85ca-e7480c8be526"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "b4f1de47-6ea0-43e6-85ca-e7480c8be526"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</span><input class="stackTraceButton" id="stackTraceButton2" type="button" onclick="javascript:toggleStackTrace('2')" value="View Stack" /><div class="stackTrace" id="stackTrace2"><p>While evaluating expression: <code>#result = createPayment(#paymentName, #transactionType, #ip, #buyerLastName, #birthDay, #telephonenumber)</code></p><div class="stackTraceExceptionMessage">org.concordion.internal.InvalidExpressionException: java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/aa10b90c-81af-463f-a9b9-ae245b48ba23 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526` on 2018-02-06T11:13:09.147Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "b4f1de47-6ea0-43e6-85ca-e7480c8be526"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@2800172c[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526], Server-Timing=[projects=7; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:09 GMT], Via=[1.1 google], X-Served-By=[api-gce-40bb8d66.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"b4f1de47-6ea0-43e6-85ca-e7480c8be526"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/aa10b90c-81af-463f-a9b9-ae245b48ba23
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:07.185Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=aa10b90c-81af-463f-a9b9-ae245b48ba23,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:07.839Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=e6652de3-0075-4689-b192-a7c1e5b5565d,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=13f62add-852a-459d-9ba6-34cd3d78cc58,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=0dc5c409-1a03-4833-93db-102f96c27a84,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='b4f1de47-6ea0-43e6-85ca-e7480c8be526', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:08.517Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="272331122470", birthday="1960-07-07", ip="2001:0db8:7777:0000:6666:8a2e:0370:7334", languageCode="en", telephonenumber="0399874789345", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=b4f1de47-6ea0-43e6-85ca-e7480c8be526,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:08.517Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=ebc8efd9-69de-4c23-b0dd-d1bc1a5ad846,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:08.264Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/aa10b90c-81af-463f-a9b9-ae245b48ba23,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526]},body=io.sphere.sdk.http.StringHttpRequestBody@1f7e9a66[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"b4f1de47-6ea0-43e6-85ca-e7480c8be526"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "b4f1de47-6ea0-43e6-85ca-e7480c8be526"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.encodeThrowable (CompletableFuture.java:273)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.completeThrowable (CompletableFuture.java:280)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:604)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div><div class="stackTraceExceptionMessage">java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/aa10b90c-81af-463f-a9b9-ae245b48ba23 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526` on 2018-02-06T11:13:09.147Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "b4f1de47-6ea0-43e6-85ca-e7480c8be526"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@2800172c[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526], Server-Timing=[projects=7; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:09 GMT], Via=[1.1 google], X-Served-By=[api-gce-40bb8d66.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"b4f1de47-6ea0-43e6-85ca-e7480c8be526"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/aa10b90c-81af-463f-a9b9-ae245b48ba23
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:07.185Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=aa10b90c-81af-463f-a9b9-ae245b48ba23,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:07.839Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=e6652de3-0075-4689-b192-a7c1e5b5565d,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=13f62add-852a-459d-9ba6-34cd3d78cc58,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=0dc5c409-1a03-4833-93db-102f96c27a84,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='b4f1de47-6ea0-43e6-85ca-e7480c8be526', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:08.517Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="272331122470", birthday="1960-07-07", ip="2001:0db8:7777:0000:6666:8a2e:0370:7334", languageCode="en", telephonenumber="0399874789345", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=b4f1de47-6ea0-43e6-85ca-e7480c8be526,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:08.517Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=ebc8efd9-69de-4c23-b0dd-d1bc1a5ad846,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:08.264Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/aa10b90c-81af-463f-a9b9-ae245b48ba23,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526]},body=io.sphere.sdk.http.StringHttpRequestBody@1f7e9a66[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"b4f1de47-6ea0-43e6-85ca-e7480c8be526"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "b4f1de47-6ea0-43e6-85ca-e7480c8be526"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.encodeThrowable (CompletableFuture.java:273)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.completeThrowable (CompletableFuture.java:280)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:604)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div><div class="stackTraceExceptionMessage">io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/aa10b90c-81af-463f-a9b9-ae245b48ba23 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526` on 2018-02-06T11:13:09.147Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "b4f1de47-6ea0-43e6-85ca-e7480c8be526"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@2800172c[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526], Server-Timing=[projects=7; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:09 GMT], Via=[1.1 google], X-Served-By=[api-gce-40bb8d66.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"b4f1de47-6ea0-43e6-85ca-e7480c8be526"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/aa10b90c-81af-463f-a9b9-ae245b48ba23
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:07.185Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=aa10b90c-81af-463f-a9b9-ae245b48ba23,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:07.839Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=e6652de3-0075-4689-b192-a7c1e5b5565d,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=13f62add-852a-459d-9ba6-34cd3d78cc58,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=0dc5c409-1a03-4833-93db-102f96c27a84,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='b4f1de47-6ea0-43e6-85ca-e7480c8be526', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:08.517Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="272331122470", birthday="1960-07-07", ip="2001:0db8:7777:0000:6666:8a2e:0370:7334", languageCode="en", telephonenumber="0399874789345", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=b4f1de47-6ea0-43e6-85ca-e7480c8be526,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:08.517Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=ebc8efd9-69de-4c23-b0dd-d1bc1a5ad846,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:08.264Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/aa10b90c-81af-463f-a9b9-ae245b48ba23,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/ea3c1613-fb5d-4403-9757-6ce75e04b526]},body=io.sphere.sdk.http.StringHttpRequestBody@1f7e9a66[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"b4f1de47-6ea0-43e6-85ca-e7480c8be526"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "b4f1de47-6ea0-43e6-85ca-e7480c8be526"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.lambda$of$13 (ExceptionFactory.java:57)</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.lambda$whenStatus$1 (ExceptionFactory.java:31)</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.createException (ExceptionFactory.java:76)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.createExceptionFor (SphereClientImpl.java:149)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.parse (SphereClientImpl.java:134)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.processHttpResponse (SphereClientImpl.java:128)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.lambda$executeWithRecover$4 (SphereClientImpl.java:85)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:602)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div></div></tr>
        <tr><span class="failure"><del class="expected">
            <td class="inputvalue">Payment 3</td>
            <td class="inputvalue">AUTHORIZATION</td>
            <td class="inputvalue">Denied</td> <!-- It's a buyer surname, see https://developers.klarna.com/en/de/kpm/test-credentials-->
            <td class="inputvalue">1960-07-07</td>
            <td class="inputvalue">1.1.1.1</td>
            <td class="inputvalue">099776655</td>
            <td />
            <td>1960-07-07</td>
            <td>1.1.1.1</td>
            <td>099776655</td>
        </del></span><span class="exceptionMessage">java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/fb72bfce-fa42-40ee-8ed0-08304da6b505 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5` on 2018-02-06T11:13:10.132Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "98dd2eb3-e280-4740-82f7-ac99d345ae0c"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@6aea6442[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5], Server-Timing=[projects=7; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:10 GMT], Via=[1.1 google], X-Served-By=[api-gce-5b2ab894.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"98dd2eb3-e280-4740-82f7-ac99d345ae0c"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/fb72bfce-fa42-40ee-8ed0-08304da6b505
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Denied, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:09.291Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=fb72bfce-fa42-40ee-8ed0-08304da6b505,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:09.589Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=3ac04b48-a767-4797-b876-7f9751283de3,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=2408e534-1870-4c89-a5d4-ef6f1336a0cd,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=58e5adf8-964c-488e-8eb1-4a204f1ce689,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='98dd2eb3-e280-4740-82f7-ac99d345ae0c', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:09.850Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="273920515612", birthday="1960-07-07", ip="1.1.1.1", languageCode="en", telephonenumber="099776655", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=98dd2eb3-e280-4740-82f7-ac99d345ae0c,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:09.850Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=b6bb2fc3-cb1f-4f64-b74f-addc25b7b2c8,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:09.775Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/fb72bfce-fa42-40ee-8ed0-08304da6b505,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5]},body=io.sphere.sdk.http.StringHttpRequestBody@e9b557b[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"98dd2eb3-e280-4740-82f7-ac99d345ae0c"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "98dd2eb3-e280-4740-82f7-ac99d345ae0c"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</span><input class="stackTraceButton" id="stackTraceButton3" type="button" onclick="javascript:toggleStackTrace('3')" value="View Stack" /><div class="stackTrace" id="stackTrace3"><p>While evaluating expression: <code>#result = createPayment(#paymentName, #transactionType, #ip, #buyerLastName, #birthDay, #telephonenumber)</code></p><div class="stackTraceExceptionMessage">org.concordion.internal.InvalidExpressionException: java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/fb72bfce-fa42-40ee-8ed0-08304da6b505 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5` on 2018-02-06T11:13:10.132Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "98dd2eb3-e280-4740-82f7-ac99d345ae0c"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@6aea6442[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5], Server-Timing=[projects=7; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:10 GMT], Via=[1.1 google], X-Served-By=[api-gce-5b2ab894.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"98dd2eb3-e280-4740-82f7-ac99d345ae0c"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/fb72bfce-fa42-40ee-8ed0-08304da6b505
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Denied, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:09.291Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=fb72bfce-fa42-40ee-8ed0-08304da6b505,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:09.589Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=3ac04b48-a767-4797-b876-7f9751283de3,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=2408e534-1870-4c89-a5d4-ef6f1336a0cd,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=58e5adf8-964c-488e-8eb1-4a204f1ce689,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='98dd2eb3-e280-4740-82f7-ac99d345ae0c', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:09.850Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="273920515612", birthday="1960-07-07", ip="1.1.1.1", languageCode="en", telephonenumber="099776655", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=98dd2eb3-e280-4740-82f7-ac99d345ae0c,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:09.850Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=b6bb2fc3-cb1f-4f64-b74f-addc25b7b2c8,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:09.775Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/fb72bfce-fa42-40ee-8ed0-08304da6b505,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5]},body=io.sphere.sdk.http.StringHttpRequestBody@e9b557b[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"98dd2eb3-e280-4740-82f7-ac99d345ae0c"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "98dd2eb3-e280-4740-82f7-ac99d345ae0c"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.encodeThrowable (CompletableFuture.java:273)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.completeThrowable (CompletableFuture.java:280)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:604)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div><div class="stackTraceExceptionMessage">java.util.concurrent.CompletionException: io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/fb72bfce-fa42-40ee-8ed0-08304da6b505 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5` on 2018-02-06T11:13:10.132Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "98dd2eb3-e280-4740-82f7-ac99d345ae0c"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@6aea6442[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5], Server-Timing=[projects=7; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:10 GMT], Via=[1.1 google], X-Served-By=[api-gce-5b2ab894.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"98dd2eb3-e280-4740-82f7-ac99d345ae0c"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/fb72bfce-fa42-40ee-8ed0-08304da6b505
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Denied, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:09.291Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=fb72bfce-fa42-40ee-8ed0-08304da6b505,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:09.589Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=3ac04b48-a767-4797-b876-7f9751283de3,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=2408e534-1870-4c89-a5d4-ef6f1336a0cd,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=58e5adf8-964c-488e-8eb1-4a204f1ce689,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='98dd2eb3-e280-4740-82f7-ac99d345ae0c', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:09.850Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="273920515612", birthday="1960-07-07", ip="1.1.1.1", languageCode="en", telephonenumber="099776655", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=98dd2eb3-e280-4740-82f7-ac99d345ae0c,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:09.850Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=b6bb2fc3-cb1f-4f64-b74f-addc25b7b2c8,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:09.775Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/fb72bfce-fa42-40ee-8ed0-08304da6b505,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5]},body=io.sphere.sdk.http.StringHttpRequestBody@e9b557b[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"98dd2eb3-e280-4740-82f7-ac99d345ae0c"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "98dd2eb3-e280-4740-82f7-ac99d345ae0c"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.encodeThrowable (CompletableFuture.java:273)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.completeThrowable (CompletableFuture.java:280)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:604)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div><div class="stackTraceExceptionMessage">io.sphere.sdk.client.ErrorResponseException: detailMessage: The cart is not in active state.
summary: POST https://api.sphere.io/payone-integration-tests-heroku-17/carts/fb72bfce-fa42-40ee-8ed0-08304da6b505 failed  with response code 400 with X-Correlation-ID `payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5` on 2018-02-06T11:13:10.132Z
http response formatted body: {
  "statusCode" : 400,
  "message" : "The cart is not in active state.",
  "errors" : [ {
    "code" : "InvalidOperation",
    "message" : "The cart is not in active state.",
    "action" : {
      "action" : "addPayment",
      "payment" : {
        "typeId" : "payment",
        "id" : "98dd2eb3-e280-4740-82f7-ac99d345ae0c"
      }
    },
    "actionIndex" : 1
  } ]
}
http response: io.sphere.sdk.http.HttpResponseImpl@6aea6442[statusCode=400,headers={Alt-Svc=[clear], Server=[nginx], Access-Control-Allow-Origin=[*], Access-Control-Allow-Methods=[GET, POST, DELETE, OPTIONS], X-Correlation-ID=[payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5], Server-Timing=[projects=7; "projects"], Access-Control-Allow-Headers=[Accept, Authorization, Content-Type, Origin, User-Agent], Date=[Tue, 06 Feb 2018 11:13:10 GMT], Via=[1.1 google], X-Served-By=[api-gce-5b2ab894.sphere.prod.commercetools.de], X-Served-Config=[sphere-projects-ws-1.0], Access-Control-Max-Age=[299], Content-Length=[271], Content-Type=[application/json; charset=utf-8]},associatedRequest=&lt;null&gt;,textInterpretedBody={"statusCode":400,"message":"The cart is not in active state.","errors":[{"code":"InvalidOperation","message":"The cart is not in active state.","action":{"action":"addPayment","payment":{"typeId":"payment","id":"98dd2eb3-e280-4740-82f7-ac99d345ae0c"}},"actionIndex":1}]}]
SDK: 1.28.0
project: payone-integration-tests-heroku-17
endpoint: POST /carts/fb72bfce-fa42-40ee-8ed0-08304da6b505
Java: 1.8.0_151
cwd: /home/travis/build/commercetools/commercetools-payone-integration/functionaltests
sphere request: CartUpdateCommandImpl[versioned=CartImpl[anonymousId=&lt;null&gt;,billingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Denied, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},cartState=ORDERED,country=UK,createdAt=2018-02-06T11:13:09.291Z,custom=&lt;null&gt;,customLineItems=[],customerEmail=youremail@email.com,customerGroup=&lt;null&gt;,customerId=&lt;null&gt;,deleteDaysAfterLastModification=&lt;null&gt;,discountCodes=[DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='fdcbc045-b7c2-4dae-9471-31d6b7f04c5d', obj=null},state=MATCHES_CART], DiscountCodeInfoImpl[discountCode=Reference{typeId='discount-code', id='076aff82-e711-44a4-9e6e-c9270e953a65', obj=null},state=MATCHES_CART]],id=fb72bfce-fa42-40ee-8ed0-08304da6b505,inventoryMode=NONE,lastModifiedAt=2018-02-06T11:13:09.589Z,lineItems=[LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.94], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.81]]]], DiscountedLineItemPriceForQuantityImpl[quantity=3,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 115.24,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 1.95], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 12.8]]]]],distributionChannel=&lt;null&gt;,id=3ac04b48-a767-4797-b876-7f9751283de3,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Necklace),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99],priceMode=PLATFORM,productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,productSlug=LocalizedString(en -&gt; necklace-1495635523693),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=4,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=4]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 387.36,totalGross=EUR 460.96,taxPortions=&lt;null&gt;],totalPrice=EUR 460.96,variant=ProductVariantImpl[productId=aa5bf70f-ee70-4587-a7e6-765eeefab252,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=5c3bba8e-ffdf-4e33-9c6a-803e92bb34d7,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 129.99], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=320b1711-a3af-4840-b9c6-e64e3fcfc6b1,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 119.98]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=123454323454667]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 0,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 0]]]]],distributionChannel=&lt;null&gt;,id=2408e534-1870-4c89-a5d4-ef6f1336a0cd,lineItemMode=STANDARD,name=LocalizedString(en -&gt; box),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0],priceMode=PLATFORM,productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,productSlug=LocalizedString(en -&gt; box-1495636369833),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=1,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=1]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 0,totalGross=EUR 0,taxPortions=&lt;null&gt;],totalPrice=EUR 0,variant=ProductVariantImpl[productId=fbe5f5a7-3ce5-4290-b094-9b79391d01f2,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=cc9ffb9f-1433-4707-aaca-74d3365139af,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 0]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=2345234523]], LineItemImpl[custom=&lt;null&gt;,discountedPricePerQuantity=[DiscountedLineItemPriceForQuantityImpl[quantity=2,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.65,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.73], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]], DiscountedLineItemPriceForQuantityImpl[quantity=1,discountedPrice=DiscountedLineItemPriceImpl[value=EUR 43.64,includedDiscounts=[DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='59ae8cb2-26e4-411e-96b5-a13265d334e2', obj=null},discountedAmount=EUR 0.74], DiscountedLineItemPortionImpl[discount=Reference{typeId='cart-discount', id='f710cf37-4817-40ed-ae1a-8dc09bf2c397', obj=null},discountedAmount=EUR 4.85]]]]],distributionChannel=&lt;null&gt;,id=58e5adf8-964c-488e-8eb1-4a204f1ce689,lineItemMode=STANDARD,name=LocalizedString(en -&gt; Ring),price=PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23],priceMode=PLATFORM,productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,productSlug=LocalizedString(en -&gt; ring-1495636466755),productType=Reference{typeId='product-type', id='9c632515-6d7a-4385-8438-671a822b1b82', obj=null},quantity=3,state=[ItemStateImpl[state=Reference{typeId='state', id='9ae7b755-6d83-4316-8c5c-87ec1ef88716', obj=null},quantity=3]],supplyChannel=&lt;null&gt;,taxRate=TaxRateImpl[id=cp110K8t,name=19% MwSt,amount=0.19,includedInPrice=true,country=DE,state=&lt;null&gt;,subRates=[]],taxedPrice=TaxedPriceImpl[totalNet=EUR 110.03,totalGross=EUR 130.94,taxPortions=&lt;null&gt;],totalPrice=EUR 130.94,variant=ProductVariantImpl[productId=64b7b5b6-1926-44c9-87ee-46d2f17c1538,assets=[],attributes=[],availability=&lt;null&gt;,id=1,images=[],key=&lt;null&gt;,matchingVariant=&lt;null&gt;,price=&lt;null&gt;,prices=[PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=8ee4277f-91f2-4ee7-b5bc-fa1988b56e14,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=EUR 49.23], PriceImpl[channel=&lt;null&gt;,country=&lt;null&gt;,custom=&lt;null&gt;,customerGroup=&lt;null&gt;,discounted=&lt;null&gt;,id=98590d9c-3716-4b5c-a75d-c9dc339660a0,tiers=&lt;null&gt;,validFrom=&lt;null&gt;,validUntil=&lt;null&gt;,value=CHF 45.11]],scopedPrice=&lt;null&gt;,scopedPriceDiscounted=&lt;null&gt;,sku=456786468866578]]],locale=en,paymentInfo=&lt;null&gt;,refusedGifts=[],shippingAddress=Address{country=DE, id=null, title=Mr., salutation=null, firstName=Testperson-de, lastName=Approved, streetName=Hellersbergstraße 14, streetNumber=null, additionalStreetInfo=, postalCode=41460, city=Neuss, region=null, state=null, company=null, department=null, building=null, apartment=null, poBox=null, phone=01522113356, mobile=null, email=youremail@email.com, additionalAddressInfo=null, fax=null, externalId=null},shippingInfo=&lt;null&gt;,shippingRateInput=&lt;null&gt;,taxCalculationMode=LINE_ITEM_LEVEL,taxMode=PLATFORM,taxRoundingMode=HALF_EVEN,taxedPrice=TaxedPriceImpl[totalNet=EUR 497.39,totalGross=EUR 591.9,taxPortions=[TaxPortionImpl[rate=0.19,amount=EUR 94.51,name=19% MwSt]]],totalPrice=EUR 591.9,version=11],updateActions=[AddPayment[payment=Reference{typeId='payment', id='98dd2eb3-e280-4740-82f7-ac99d345ae0c', obj=PaymentImpl[amountAuthorized=&lt;null&gt;,amountPaid=&lt;null&gt;,amountPlanned=EUR 591.9,amountRefunded=&lt;null&gt;,authorizedUntil=&lt;null&gt;,createdAt=2018-02-06T11:13:09.850Z,custom=CustomFieldsImpl[type=Reference{typeId='type', id='3b67708e-529a-4d32-9233-79c0c25912e4', obj=null},fields={reference="273920515612", birthday="1960-07-07", ip="1.1.1.1", languageCode="en", telephonenumber="099776655", gender="m"}],customer=Reference{typeId='customer', id='bf894977-45fe-428f-94f5-deb9c2c1abca', obj=null},externalId=&lt;null&gt;,id=98dd2eb3-e280-4740-82f7-ac99d345ae0c,interfaceId=&lt;null&gt;,interfaceInteractions=[],key=&lt;null&gt;,lastModifiedAt=2018-02-06T11:13:09.850Z,paymentMethodInfo=PaymentMethodInfoImpl[paymentInterface=PAYONE,method=INVOICE-KLARNA,name=&lt;null&gt;],paymentStatus=PaymentStatusImpl[interfaceCode=&lt;null&gt;,interfaceText=&lt;null&gt;,state=&lt;null&gt;],transactions=[TransactionImpl[amount=EUR 591.9,id=b6bb2fc3-cb1f-4f64-b74f-addc25b7b2c8,interactionId=&lt;null&gt;,state=PENDING,timestamp=2018-02-06T11:13:09.775Z,type=AUTHORIZATION]],version=1]},action=addPayment]],javaType=[simple type, class io.sphere.sdk.carts.Cart],baseEndpointWithoutId=/carts,creationFunction=io.sphere.sdk.carts.commands.CartUpdateCommandImpl$$Lambda$241/1199691010@5f835541,expansionModel=CartExpansionModelImpl[pathExpressions=[]],expansionPaths=[],additionalHttpQueryParameters=[]]
http request: HttpRequestImpl[httpMethod=POST,url=https://api.sphere.io/payone-integration-tests-heroku-17/carts/fb72bfce-fa42-40ee-8ed0-08304da6b505,headers={Authorization=[**removed from output**], User-Agent=[commercetools-jvm-sdk/1.28.0 (AHC/2.0) Java/1.8.0_151-b12 (Linux; amd64)], Accept-Encoding=[gzip], X-Correlation-ID=[payone-integration-tests-heroku-17/ee308517-34e8-470c-bcf6-027a02576bb5]},body=io.sphere.sdk.http.StringHttpRequestBody@e9b557b[body={"version":11,"actions":[{"action":"addPayment","payment":{"typeId":"payment","id":"98dd2eb3-e280-4740-82f7-ac99d345ae0c"}}]}]]
http request formatted body: {
  "version" : 11,
  "actions" : [ {
    "action" : "addPayment",
    "payment" : {
      "typeId" : "payment",
      "id" : "98dd2eb3-e280-4740-82f7-ac99d345ae0c"
    }
  } ]
}
additional notes: []
Javadoc: http://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/client/ErrorResponseException.html
</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.lambda$of$13 (ExceptionFactory.java:57)</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.lambda$whenStatus$1 (ExceptionFactory.java:31)</div><div class="stackTraceEntry">at io.sphere.sdk.client.ExceptionFactory.createException (ExceptionFactory.java:76)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.createExceptionFor (SphereClientImpl.java:149)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.parse (SphereClientImpl.java:134)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.processHttpResponse (SphereClientImpl.java:128)</div><div class="stackTraceEntry">at io.sphere.sdk.client.SphereClientImpl.lambda$executeWithRecover$4 (SphereClientImpl.java:85)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture.uniApply (CompletableFuture.java:602)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$UniApply.tryFire (CompletableFuture.java:577)</div><div class="stackTraceEntry">at java.util.concurrent.CompletableFuture$Completion.run (CompletableFuture.java:442)</div><div class="stackTraceEntry">at java.lang.Thread.run (Thread.java:748)</div></div></tr>
    </table>
    <p>
        <sup><a name="buyer-lastname-description" href="#buyer-lastname-description">[1]</a></sup><i>See more
        information on
        <a href="https://developers.klarna.com/en/de/kpm/test-credentials" target="_blank">Klarna test credentials</a>
        page</i>
    </p>

    <h3>Handle the payments</h3>

    <p>
        When I request the integration service to handle them I will get the following results:
    </p>
    <table c:execute="#result = handlePayment(#paymentName, #requestType)">
        <tr>
            <th c:set="#paymentName">Payment Name</th>
            <th c:assertEquals="#result.statusCode">Response Status Code</th>
            <th c:set="#requestType">Request type</th>
            <th c:assertEquals="#result.interactionCount">total # of requests sent</th>
            <th c:assertEquals="#result.transactionState">Transaction State</th>
            <th c:assertEquals="#result.interfaceCode">Interface Code</th>
            <th c:echo="#result.version">Version (for information only)</th>
            <th c:echo="#result.interfaceId">Transaction Id(for information only)</th>
        </tr>
        <tr>
            <td class="inputvalue">Payment 1</td>
            <td class="failure"><del class="expected">200</del>
<ins class="actual">404</ins></td>
            <td class="inputvalue">preauthorization</td>
            <td class="failure"><del class="expected">1</del>
<ins class="actual">0</ins></td>
            <td class="failure"><del class="expected">Success</del>
<ins class="actual">Pending</ins></td>
            <td class="failure"><del class="expected">APPROVED</del>
<ins class="actual">(null)</ins></td>
            <td>1</td>
            <td><em>null</em></td>
        </tr>
        <tr>
            <td class="inputvalue">Payment 2</td>
            <td class="failure"><del class="expected">200</del>
<ins class="actual">404</ins></td>
            <td class="inputvalue">preauthorization</td>
            <td class="failure"><del class="expected">1</del>
<ins class="actual">0</ins></td>
            <td class="failure"><del class="expected">Success</del>
<ins class="actual">Pending</ins></td>
            <td class="failure"><del class="expected">APPROVED</del>
<ins class="actual">(null)</ins></td>
            <td>1</td>
            <td><em>null</em></td>
        </tr>
    </table>

    <p><code><b><span c:set="#payment3" class="inputvalue">Payment 3</span></b></code> (with <i>Denied</i> last name) expected to have
        <span c:set="#payment3Request" class="inputvalue">preauthorization</span> transaction with following values:
        <span c:execute="#payment3Handle = handlePayment(#payment3, #payment3Request)" />
    <ul>
        <li>Status <span c:assertEquals="#payment3Handle.statusCode" class="failure"><del class="expected">200</del>
<ins class="actual">404</ins></span></li>
    <li>total # of requests sent <span c:assertEquals="#payment3Handle.interactionCount" class="failure"><del class="expected">1</del>
<ins class="actual">0</ins></span></li>
    <li>Transaction State <span c:assertEquals="#payment3Handle.transactionState" class="failure"><del class="expected">Failure</del>
<ins class="actual">Pending</ins></span></li>
    <li>Interface Code <code><b><span c:echo="#payment3Handle.interfaceCode"><em>null</em></span></b></code>
        <span c:assertTrue="containsSubstring(#payment3Handle.interfaceCode, 'ERROR')" class="failure"><del class="expected">
            <i>contains <code>ERROR</code></i> substring</del>
<ins class="actual">== false</ins></span>
        <sup><b><a href="#error-code-description">[2]</a></b></sup>
    </li>
    </ul>
    </p>
    <p>
        <sup><a name="error-code-description" href="#error-code-description">[2]</a></sup>
        <i>For now <code><b>ERROR 945 (Amount too high)</b> </code> is expected,
            but this is not explicitly specified by Payone or Klarna.</i>
    </p>

    <h3>Wait for payment notifications:</h3>

    <p c:execute="#receivedAllNotifications = receivedNotificationOfActionFor(#successfulPayments, #txactionAppointed)">
        After a certain amount of time the Integration Service will have
        <span c:assertTrue="#receivedAllNotifications" class="failure"><del class="expected">processed a notification from PAYONE</del>
<ins class="actual">== false</ins></span>
        with the txaction <b c:set="#txactionAppointed" class="inputvalue">appointed</b> and the transactionstatus <b>completed</b> (or <b>null</b>)
        for each of the payments <span c:set="#successfulPayments" class="inputvalue">Payment 1, Payment 2</span>.
        The transaction state and the authorized amount should be set correctly not later than now.
    </p>
    <table c:execute="#result = fetchPaymentDetails(#paymentName)">
        <tr>
            <th c:set="#paymentName">Payment Name</th>
            <th c:assertEquals="#result.notificationCount">total # of <em>appointed/completed</em> notifications</th>
            <th c:assertEquals="#result.transactionState">Transaction State</th>
            <th c:echo="#result.version">Version (for information only)</th>
        </tr>
        <tr>
            <td class="inputvalue">Payment 1</td>
            <td class="failure"><del class="expected">1</del>
<ins class="actual">0</ins></td>
            <td class="failure"><del class="expected">Success</del>
<ins class="actual">Pending</ins></td>
            <td>1</td>
        </tr>
        <tr>
            <td class="inputvalue">Payment 2</td>
            <td class="failure"><del class="expected">1</del>
<ins class="actual">0</ins></td>
            <td class="failure"><del class="expected">Success</del>
<ins class="actual">Pending</ins></td>
            <td>1</td>
        </tr>
    </table>
    <p>
        The failed payment <span c:set="#failedPaymentName" class="inputvalue">Payment 3</span>
        must have received <span c:assertEquals="getInteractionNotificationOfActionCount(#failedPaymentName, #txactionAppointed)" class="success">0</span> notifications.
    </p>
</div>
<div class="footer">Results generated by <a href="http://www.concordion.org" style="font-weight: bold; text-decoration: none; color: #89C;">Concordion</a><div class="testTime">in 910473 ms on 06-Feb-2018 at 11:28:13 UTC</div></div></body>
</html>